# Qanary Framework

## Context

Many of the common tasks in Knowledge Graph Question Answering are already solved or have a typical solution. In this regard, to help developers [not to reinvent the wheel](https://dl.acm.org/doi/10.1145/3178876.3186023) — frameworks come in to play (which is true not only for KGQA but for software engineering in general). There exist several frameworks for Question Answering & Chatbots. In general, they can be divided in to two types — low-code frameworks (e.g., [Dialogflow](https://cloud.google.com/dialogflow/docs), [Bot Framework](https://dev.botframework.com/)), and traditional frameworks (e.g., [Rasa](https://rasa.com/), [DeepPavlov](https://deeppavlov.ai/), [Qanary](https://github.com/WDAqua/Qanary)).
The aforementioned Qanary Framework stands out among the others because of the following reasons: 

* the framework helps you to facilitate KGQA system with multiple independent components;
* each component is implemented as a microservice and agnostic to the used programming language;
* the components interact with each other by writing and reading standardized RDF annotations from a common triplestore;
* a user of the framework may reuse components, developed and deployed by other users without having access the source code;
* the question answering process becomes transparent, interpretable, and explainable because all the data generated by components is stored in a triplestore (i.e., the process can be traced).

The Qanary framework has two major sub-systems: 

1. [Qanary pipeline](https://webengineering.ins.hs-anhalt.de:43740/startquestionansweringwithtextquestion), and 
2. [Qanary components](https://github.com/WDAqua/Qanary-question-answering-components). 
 
The first one serves a similar to [API gateway](https://docs.microsoft.com/en-us/azure/architecture/guide/architecture-styles/microservices) function which is to execute components with certain parameters in a certain order. The second sub-system is actually a set of components that were developed and deployed by the Qanary community (note: be aware that this is just an open collection, there might be many more components out there).
One can reuse both of the ecosystems in order to implement his/her question answering system.

## Learning Objectives

* Learn how to integrate your QA components with the Qanary Framework;
* Learn how to use UI template to work with your QA system.

## Task

Integrate the Qanary Framework into your Simple Question Answering system developed in the [previous exercise](https://github.com/Perevalov/qa_chatbots_exercises/tree/main/exercise_4). Hence, each of your components has be to wrapped up according to the [example](https://github.com/Perevalov/qa_chatbots_exercises/tree/main/exercise_5/qanary_example), s.t., it becomes a Qanary component. Exclude API Gateway from your system, now [Qanary pipeline](https://webengineering.ins.hs-anhalt.de:43740/startquestionansweringwithtextquestion) will take care of calling the components. Use our [general chatbot frontend](https://webengineering.ins.hs-anhalt.de:43712/) for testing your system.

### Sketch a component-oriented solution

In any component oriented system, you need to make sure that the purpose of a component is clear (cf. your Software Engineering). Hence, in a Qanary system, this is also the first step. 

1. Sketch the components you plan to establish in your system (and give them names) — use material from the previous exercise.
2. Define 3 examples of questions for which your system should be capable to provide answers.
3. For each example, execute the QA process manually (on a sheet of paper or on a whiteboard) and hereby create Qanary annotations to express the information created by each of your components. In the last process, check the following: Are all required information availale to create a query and retrieve the answer? Can the final component (typically: Query Builder) decide if the information is valide, and hence reject false 
4. Test your system with 3 examples that should not be answered by your QA system (i.e., the system should recognize that the input is not sufficient).

Note: This process was also done in the lecture.

### Transforming components to Qanary framework

In a Qanary system, the components are independent and run in a standalone process. They register themselves in the Qanary pipeline (and can be [activated](https://webengineering.ins.hs-anhalt.de:43740/startquestionansweringwithtextquestion). To do this, the pipeline needs to "see" your components, so if you don't have external IP address of your PC, you probably need such tool as [ngrok](https://ngrok.com/download) to expose the corresponding ports to the internet.

1. Download and unpack [ngrok](https://ngrok.com/download);
1. Run `./ngrok http YOUR_PORT` in the directory of the ngrok (if you use Windows, check documentation of ngrok);
1. Use the [the example](https://github.com/Perevalov/qa_chatbots_exercises/tree/main/exercise_5/qanary_example) to implement and run your components (hint: please, add your surname or similar to the component's name, s.t., it is easy to find them);
1. Go to public [Qanary Admin panel](http://webengineering.ins.hs-anhalt.de:43740) of our Qanary example installation to see if your components are running:
![image](https://user-images.githubusercontent.com/16652575/140662053-c7322282-e219-43db-929c-d0648e541917.png)
1. If all the components are recognized, move to the next part.

NOTE: adjust the functionality of your SPARQL Generator/Executor as follows — the component just generates the query and stores it in the triplestore (see [the example](https://github.com/Perevalov/qa_chatbots_exercises/tree/main/exercise_5/qanary_example) for this).

### Asking questions with [Qanary pipeline](https://webengineering.ins.hs-anhalt.de:43740/startquestionansweringwithtextquestion)

1. Navigate to the [Qanary pipeline](https://webengineering.ins.hs-anhalt.de:43740/startquestionansweringwithtextquestion);
1. Select the components to be executed and adjust the order by dragging them;
1. Insert a textual question in the field and click "start Question Answering..."
1. If everything is good, then you will see the following output, it corresponds to the graph id, where all your execution annotations are stored:
![image](https://user-images.githubusercontent.com/16652575/140662074-75214be1-87ab-44e9-b097-122988e9f961.png)
1. Check the console of your components, there should be no errors.


### Using general chatbot frontend

1. Navigate to the [general chatbot frontend](https://webengineering.ins.hs-anhalt.de:43712/)
1. Open settings modal window, and put there your components in the corresponding execution order, at the end put SparqlExecutor:
![image](https://user-images.githubusercontent.com/16652575/140775649-a74dd3a2-02ad-4af3-953b-0a6ae2efaf49.png)
1. Ask any question that is supported by your system via the frontend and see the answer:
![image](https://user-images.githubusercontent.com/16652575/140775858-b937a371-4ed4-40d9-bb15-f2e5ebb9b475.png)


## Submission check

In this exercise, **submission check will be performed in two steps**:

1. You send the code with your solution and the README with a description of files to Moodle (as usual). Then, I check it. If everything is OK, we move to the second step.
2. On the exercise, you perform a system demonstration.

After completion of these two steps, you pass the exercise.

## Guidance / Tutorials

* Qanary wiki: https://github.com/WDAqua/Qanary/wiki
* Qanary Admin panel: http://webengineering.ins.hs-anhalt.de:43740/#/applications
* Qanary Question Answering Components repository: https://github.com/WDAqua/Qanary-question-answering-components
* General chatbot frontend: https://webengineering.ins.hs-anhalt.de:43712/
* Create Qanary component using Java: https://github.com/WDAqua/Qanary/wiki/How-do-I-implement-a-new-Qanary-component-using-Java%3F
* Python Qanary Helpers library: https://github.com/Perevalov/qanary_helpers
